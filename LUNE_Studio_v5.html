<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LUNE Studio 5.0 - Assistente de Cria√ß√£o de Estampas</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Inter', sans-serif; }
    .font-serif { font-family: 'Playfair Display', serif; }
    .drop-zone.dragover { border-color: #00d4aa !important; background-color: rgba(0, 212, 170, 0.1) !important; }
    .scrollbar-thin::-webkit-scrollbar { width: 6px; }
    .scrollbar-thin::-webkit-scrollbar-track { background: #1c252f; }
    .scrollbar-thin::-webkit-scrollbar-thumb { background: #2a3540; border-radius: 3px; }
    @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 20px rgba(0, 212, 170, 0.3); } 50% { box-shadow: 0 0 40px rgba(0, 212, 170, 0.6); } }
    .analyzing { animation: pulse-glow 1.5s ease-in-out infinite; }
    .prose h3 { font-size: 1.1rem; font-weight: 600; color: #00d4aa; margin-top: 1.5rem; margin-bottom: 0.75rem; }
    .prose p { margin-bottom: 0.75rem; color: #c0d4e6; font-size: 0.9rem; line-height: 1.7; }
    .prose strong { color: #f0f4f8; }
    .prompt-box { background: #111820; border: 1px solid #2a3540; border-radius: 12px; padding: 16px; margin-bottom: 12px; }
    .prompt-box:hover { border-color: #00d4aa; }
    .prompt-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .prompt-title { font-size: 0.85rem; font-weight: 600; color: #00d4aa; }
    .prompt-copy { font-size: 0.75rem; color: #8899a6; cursor: pointer; padding: 4px 8px; border-radius: 6px; }
    .prompt-copy:hover { background: #2a3540; color: #00d4aa; }
    .prompt-text { font-size: 0.8rem; color: #c0d4e6; font-family: monospace; white-space: pre-wrap; line-height: 1.6; }
    .comercial-badge { display: inline-flex; align-items: center; gap: 8px; padding: 8px 16px; border-radius: 20px; font-size: 0.85rem; font-weight: 500; }
    .comercial-high { background: linear-gradient(135deg, #10b981, #059669); color: white; }
    .comercial-medium { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
    .comercial-low { background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; }
    .tab-active { background: #00d4aa; color: #0a0f14; }
    .color-swatch { width: 40px; height: 40px; border-radius: 8px; border: 2px solid rgba(255,255,255,0.1); cursor: pointer; transition: transform 0.2s; }
    .color-swatch:hover { transform: scale(1.1); }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .fade-in { animation: fadeIn 0.5s ease-out forwards; }
  </style>
</head>
<body class="bg-[#0a0f14] text-[#f0f4f8] min-h-screen">
  <div id="app">
    <!-- Header -->
    <header class="sticky top-0 z-50 bg-[#0a0f14]/95 backdrop-blur-sm border-b border-[#1c252f]">
      <div class="max-w-7xl mx-auto px-4 md:px-8 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-4">
            <div class="w-10 h-10 bg-[#00d4aa] rounded-full flex items-center justify-center">
              <span class="text-[#0a0f14] text-xl">üåô</span>
            </div>
            <div>
              <h1 class="text-xl font-bold">LUNE <span class="text-[#00d4aa]">Studio</span> <span class="text-xs text-[#8899a6]">5.0</span></h1>
              <p class="text-xs text-[#8899a6]">ASSISTENTE DE CRIA√á√ÉO DE ESTAMPAS ‚Ä¢ Claude AI</p>
            </div>
          </div>
          <div class="flex items-center gap-2">
            <button onclick="showTab('criar')" id="tab-criar" class="tab-active px-4 py-2 rounded-lg text-sm font-medium transition-all">‚ú® Criar</button>
            <button onclick="showTab('modelagens')" id="tab-modelagens" class="px-4 py-2 rounded-lg text-sm font-medium text-[#8899a6] hover:text-white transition-all">üëó Modelagens</button>
            <button onclick="showTab('moodboards')" id="tab-moodboards" class="px-4 py-2 rounded-lg text-sm font-medium text-[#8899a6] hover:text-white transition-all">üìã Moodboards</button>
            <button onclick="openSettings()" class="p-2 rounded-lg text-[#8899a6] hover:text-white hover:bg-[#1c252f] transition-all">‚öôÔ∏è</button>
          </div>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 md:px-8 py-8">
      <!-- Tab: Criar -->
      <div id="content-criar" class="grid md:grid-cols-2 gap-8">
        <!-- Left Column - Upload -->
        <div>
          <div id="dropZone" class="drop-zone border-2 border-dashed border-[#2a3540] rounded-2xl p-8 text-center cursor-pointer hover:border-[#00d4aa] transition-all min-h-[300px] flex flex-col items-center justify-center"
               onclick="document.getElementById('fileInput').click()"
               ondragover="handleDragOver(event)"
               ondragleave="handleDragLeave(event)"
               ondrop="handleDrop(event)">
            <div id="uploadPrompt">
              <div class="text-5xl mb-4">üì∏‚ú®</div>
              <h3 class="text-lg font-medium mb-2">Envie uma imagem de refer√™ncia</h3>
              <p class="text-sm text-[#8899a6]">Arraste e solte ou clique para selecionar</p>
              <p class="text-xs text-[#8899a6] mt-2">Formatos: PNG, JPEG (m√°x. 20MB)</p>
            </div>
            <div id="previewContainer" class="hidden w-full">
              <img id="previewImage" class="max-h-[280px] mx-auto rounded-xl object-contain" />
              <button onclick="event.stopPropagation(); removeImage()" class="mt-4 px-4 py-2 bg-red-500/20 text-red-400 rounded-lg text-sm hover:bg-red-500/30 transition-all">‚úï Remover</button>
            </div>
          </div>
          <input type="file" id="fileInput" accept="image/*" class="hidden" onchange="handleFileSelect(event)" />
          
          <button id="analyzeBtn" onclick="analyzeImage()" disabled class="w-full mt-6 py-4 bg-gradient-to-r from-[#00d4aa] to-[#00a88a] text-[#0a0f14] font-bold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed hover:shadow-lg hover:shadow-[#00d4aa]/20 transition-all">
            <span id="btnText">üîç Analisar Refer√™ncia</span>
          </button>
          
          <!-- Actions -->
          <div class="grid grid-cols-2 gap-3 mt-4">
            <button onclick="exportPDF()" class="py-3 bg-[#1c252f] rounded-xl text-sm font-medium hover:bg-[#2a3540] transition-all flex items-center justify-center gap-2">
              üìÑ Exportar PDF
            </button>
            <button onclick="saveAnalysis()" class="py-3 bg-[#1c252f] rounded-xl text-sm font-medium hover:bg-[#2a3540] transition-all flex items-center justify-center gap-2">
              üíæ Salvar
            </button>
            <button onclick="addToMoodboard()" class="py-3 bg-[#1c252f] rounded-xl text-sm font-medium hover:bg-[#2a3540] transition-all flex items-center justify-center gap-2">
              üìå Add Moodboard
            </button>
            <button onclick="copyAllPrompts()" class="py-3 bg-[#1c252f] rounded-xl text-sm font-medium hover:bg-[#2a3540] transition-all flex items-center justify-center gap-2">
              üìã Copiar Prompts
            </button>
          </div>
        </div>

        <!-- Right Column - Results -->
        <div class="space-y-6">
          <!-- Notes -->
          <div class="bg-[#111820] rounded-xl p-4 border border-[#1c252f]">
            <h3 class="text-sm font-medium text-[#8899a6] mb-2">üìù SUAS NOTAS</h3>
            <textarea id="userNotes" placeholder="Adicione suas observa√ß√µes..." class="w-full bg-transparent text-sm resize-none h-20 focus:outline-none" oninput="saveNotes()"></textarea>
          </div>

          <!-- Analysis Result -->
          <div id="analysisResult" class="hidden">
            <!-- Descri√ß√£o -->
            <div class="bg-[#111820] rounded-xl p-5 border border-[#1c252f] mb-4 fade-in">
              <h3 class="text-[#00d4aa] font-semibold mb-3 flex items-center gap-2">üé® An√°lise Visual</h3>
              <div id="descriptionContent" class="prose text-sm"></div>
            </div>

            <!-- Paleta de Cores -->
            <div class="bg-[#111820] rounded-xl p-5 border border-[#1c252f] mb-4 fade-in" style="animation-delay: 0.1s">
              <h3 class="text-[#00d4aa] font-semibold mb-3 flex items-center gap-2">üé≠ Paleta de Cores</h3>
              <div id="paletteColors" class="flex gap-3 flex-wrap mb-3"></div>
              <p id="paletteDescription" class="text-sm text-[#8899a6]"></p>
            </div>

            <!-- Potencial Comercial -->
            <div class="bg-[#111820] rounded-xl p-5 border border-[#1c252f] mb-4 fade-in" style="animation-delay: 0.2s">
              <h3 class="text-[#00d4aa] font-semibold mb-3 flex items-center gap-2">üíº Potencial Comercial</h3>
              <div id="comercialBadge" class="mb-3"></div>
              <p id="comercialDescription" class="text-sm text-[#8899a6]"></p>
            </div>

            <!-- Prompts Midjourney -->
            <div class="bg-[#111820] rounded-xl p-5 border border-[#1c252f] mb-4 fade-in" style="animation-delay: 0.3s">
              <h3 class="text-[#00d4aa] font-semibold mb-4 flex items-center gap-2">üé® Prompts Midjourney</h3>
              
              <div class="prompt-box">
                <div class="prompt-header">
                  <span class="prompt-title">üîÑ Estampa Corrida</span>
                  <span class="prompt-copy" onclick="copyPrompt('seamless')">Copiar</span>
                </div>
                <p class="text-xs text-[#8899a6] mb-2">Padr√£o seamless para Midjourney</p>
                <p id="promptSeamless" class="prompt-text"></p>
              </div>

              <div class="prompt-box">
                <div class="prompt-header">
                  <span class="prompt-title">üìç Estampa Localizada</span>
                  <span class="prompt-copy" onclick="copyPrompt('localized')">Copiar</span>
                </div>
                <p class="text-xs text-[#8899a6] mb-2">Composi√ß√£o posicionada para Midjourney</p>
                <p id="promptLocalized" class="prompt-text"></p>
              </div>

              <div class="prompt-box">
                <div class="prompt-header">
                  <span class="prompt-title">‚ûñ Barra/Cercadura</span>
                  <span class="prompt-copy" onclick="copyPrompt('border')">Copiar</span>
                </div>
                <p class="text-xs text-[#8899a6] mb-2">Border pattern para Midjourney</p>
                <p id="promptBorder" class="prompt-text"></p>
              </div>
            </div>

            <!-- Prompt Sora -->
            <div class="bg-[#111820] rounded-xl p-5 border border-[#1c252f] fade-in" style="animation-delay: 0.4s">
              <h3 class="text-[#00d4aa] font-semibold mb-4 flex items-center gap-2">‚ú® Elemento √önico (Sora)</h3>
              <div class="prompt-box">
                <div class="prompt-header">
                  <span class="prompt-title">üñºÔ∏è Template Sora</span>
                  <span class="prompt-copy" onclick="copyPrompt('sora')">Copiar</span>
                </div>
                <p class="text-xs text-[#8899a6] mb-2">Template com [ELEMENTO] e [CORES] - t√©cnica da refer√™ncia</p>
                <p id="promptSora" class="prompt-text"></p>
              </div>
            </div>
          </div>

          <!-- Empty State -->
          <div id="emptyState" class="text-center py-12">
            <div class="text-6xl mb-4">üëÅÔ∏è</div>
            <h3 class="text-lg font-medium mb-2">Aguardando an√°lise</h3>
            <p class="text-sm text-[#8899a6]">Envie uma imagem de refer√™ncia para come√ßar</p>
          </div>
        </div>
      </div>

      <!-- Tab: Modelagens -->
      <div id="content-modelagens" class="hidden">
        <div class="text-center py-20">
          <div class="text-6xl mb-4">üëó</div>
          <h3 class="text-xl font-medium mb-2">Modelagens</h3>
          <p class="text-[#8899a6]">Em breve: visualiza√ß√£o de modelagens com suas estampas</p>
        </div>
      </div>

      <!-- Tab: Moodboards -->
      <div id="content-moodboards" class="hidden">
        <div class="text-center py-20">
          <div class="text-6xl mb-4">üìã</div>
          <h3 class="text-xl font-medium mb-2">Moodboards</h3>
          <p class="text-[#8899a6]">Em breve: organize suas inspira√ß√µes em moodboards</p>
        </div>
      </div>
    </main>

    <!-- History Section -->
    <section class="max-w-7xl mx-auto px-4 md:px-8 py-8 border-t border-[#1c252f]">
      <div class="flex justify-between items-center mb-6">
        <h2 class="text-lg font-semibold">üìö Hist√≥rico</h2>
        <span id="historyCount" class="text-sm text-[#8899a6]">0 an√°lises</span>
      </div>
      <div id="historyList" class="grid md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
      <div id="historyEmpty" class="text-center py-8 text-[#8899a6]">
        <p>Suas an√°lises salvas aparecer√£o aqui</p>
      </div>
    </section>

    <!-- Settings Modal -->
    <div id="settingsModal" class="fixed inset-0 bg-black/80 z-50 hidden flex items-center justify-center p-4">
      <div class="bg-[#111820] rounded-2xl p-6 w-full max-w-md border border-[#2a3540]">
        <div class="flex justify-between items-center mb-6">
          <h2 class="text-lg font-semibold">‚öôÔ∏è Configura√ß√µes</h2>
          <button onclick="closeSettings()" class="text-[#8899a6] hover:text-white">‚úï</button>
        </div>
        
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-[#8899a6] mb-2">CHAVE DA API ANTHROPIC</label>
            <input type="password" id="apiKeyInput" placeholder="sk-ant-..." class="w-full bg-[#0a0f14] border border-[#2a3540] rounded-lg px-4 py-3 text-sm focus:outline-none focus:border-[#00d4aa]" />
          </div>
          
          <div>
            <label class="block text-sm font-medium text-[#8899a6] mb-2">--STYLIZE PADR√ÉO</label>
            <select id="stylizeSelect" class="w-full bg-[#0a0f14] border border-[#2a3540] rounded-lg px-4 py-3 text-sm focus:outline-none focus:border-[#00d4aa]">
              <option value="50">50 (Aut√™ntico)</option>
              <option value="100">100 (Padr√£o)</option>
              <option value="250">250 (Estilizado)</option>
              <option value="400">400 (Muito estilizado)</option>
            </select>
          </div>
        </div>
        
        <button onclick="saveSettings()" class="w-full mt-6 py-3 bg-[#00d4aa] text-[#0a0f14] font-bold rounded-lg hover:bg-[#00c49a] transition-all">
          Salvar
        </button>
      </div>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 bg-[#00d4aa] text-[#0a0f14] px-6 py-3 rounded-full font-medium opacity-0 transition-all duration-300 pointer-events-none">
      Copiado!
    </div>
  </div>

  <script>
    // State
    let currentImage = null;
    let currentImageBase64 = null;
    let analysisResult = null;
    let history = JSON.parse(localStorage.getItem('lune_studio_history') || '[]');

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      loadSettings();
      renderHistory();
    });

    // Settings
    function loadSettings() {
      const apiKey = localStorage.getItem('lune_anthropic_key');
      const stylize = localStorage.getItem('lune_stylize') || '50';
      if (apiKey) document.getElementById('apiKeyInput').value = apiKey;
      document.getElementById('stylizeSelect').value = stylize;
    }

    function saveSettings() {
      const apiKey = document.getElementById('apiKeyInput').value.trim();
      const stylize = document.getElementById('stylizeSelect').value;
      if (apiKey) localStorage.setItem('lune_anthropic_key', apiKey);
      localStorage.setItem('lune_stylize', stylize);
      closeSettings();
      showToast('Configura√ß√µes salvas!');
    }

    function openSettings() {
      document.getElementById('settingsModal').classList.remove('hidden');
    }

    function closeSettings() {
      document.getElementById('settingsModal').classList.add('hidden');
    }

    // Tabs
    function showTab(tab) {
      ['criar', 'modelagens', 'moodboards'].forEach(t => {
        document.getElementById('content-' + t).classList.add('hidden');
        document.getElementById('tab-' + t).classList.remove('tab-active');
        document.getElementById('tab-' + t).classList.add('text-[#8899a6]');
      });
      document.getElementById('content-' + tab).classList.remove('hidden');
      document.getElementById('tab-' + tab).classList.add('tab-active');
      document.getElementById('tab-' + tab).classList.remove('text-[#8899a6]');
    }

    // File handling
    function handleDragOver(e) {
      e.preventDefault();
      e.currentTarget.classList.add('dragover');
    }

    function handleDragLeave(e) {
      e.currentTarget.classList.remove('dragover');
    }

    function handleDrop(e) {
      e.preventDefault();
      e.currentTarget.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file && file.type.startsWith('image/')) processFile(file);
    }

    function handleFileSelect(e) {
      const file = e.target.files[0];
      if (file) processFile(file);
    }

    function processFile(file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        currentImage = e.target.result;
        currentImageBase64 = e.target.result.split(',')[1];
        document.getElementById('previewImage').src = currentImage;
        document.getElementById('uploadPrompt').classList.add('hidden');
        document.getElementById('previewContainer').classList.remove('hidden');
        document.getElementById('analyzeBtn').disabled = false;
      };
      reader.readAsDataURL(file);
    }

    function removeImage() {
      currentImage = null;
      currentImageBase64 = null;
      document.getElementById('uploadPrompt').classList.remove('hidden');
      document.getElementById('previewContainer').classList.add('hidden');
      document.getElementById('analyzeBtn').disabled = true;
      document.getElementById('fileInput').value = '';
    }

    // Analysis
    async function analyzeImage() {
      const apiKey = localStorage.getItem('lune_anthropic_key');
      if (!apiKey) {
        openSettings();
        showToast('Configure a chave API primeiro');
        return;
      }

      if (!currentImageBase64) {
        showToast('Selecione uma imagem');
        return;
      }

      const btn = document.getElementById('analyzeBtn');
      const btnText = document.getElementById('btnText');
      btn.disabled = true;
      btn.classList.add('analyzing');
      btnText.textContent = 'üîÑ Analisando com Claude...';

      const stylize = localStorage.getItem('lune_stylize') || '50';

      const prompt = `Voc√™ √© um especialista em design t√™xtil e cria√ß√£o de estampas para moda. Analise esta imagem de refer√™ncia e forne√ßa uma an√°lise detalhada para cria√ß√£o de estampas.

RESPONDA EXCLUSIVAMENTE EM JSON V√ÅLIDO, sem markdown, sem texto antes ou depois:

{
  "description": "Descri√ß√£o detalhada da imagem: composi√ß√£o, elementos visuais, estilo art√≠stico, t√©cnica (aquarela, guache, digital, etc), mood/atmosfera. 2-3 par√°grafos.",
  
  "palette": {
    "colors": ["#hex1", "#hex2", "#hex3", "#hex4", "#hex5"],
    "description": "Descri√ß√£o da paleta: temperatura, satura√ß√£o, harmonia, sensa√ß√£o que transmite"
  },
  
  "comercial": {
    "level": "high|medium|low",
    "description": "An√°lise do potencial comercial para moda feminina brasileira, considerando tend√™ncias e mercado"
  },
  
  "prompts": {
    "seamless": "Prompt em ingl√™s para Midjourney v7 para estampa corrida seamless, incluindo: elementos, cores, t√©cnica, estilo. Terminar com: seamless pattern, tileable, --stylize ${stylize} --tile --ar 1:1 --v 7",
    
    "localized": "Prompt em ingl√™s para Midjourney v7 para estampa localizada/posicionada, composi√ß√£o central. Terminar com: centered composition, placement print, --stylize ${stylize} --ar 3:4 --v 7",
    
    "border": "Prompt em ingl√™s para Midjourney v7 para barra/cercadura horizontal. Terminar com: horizontal border pattern, decorative band, --stylize ${stylize} --ar 4:1 --v 7",
    
    "sora": "Prompt em PORTUGU√äS para Sora/imagem est√°tica. Template: [ELEMENTO] em [CORES], [t√©cnica detalhada da refer√™ncia], elemento √∫nico centralizado em fundo branco puro, amplo espa√ßo negativo, sem outros elementos, sem texto"
  }
}

IMPORTANTE:
- Extraia EXATAMENTE 5 cores hexadecimais dominantes da imagem
- Os prompts devem capturar fielmente a T√âCNICA visual (pinceladas, textura, acabamento)
- Seja espec√≠fico sobre o estilo art√≠stico
- Foco em moda feminina brasileira`;

      try {
        const response = await fetch('https://api.anthropic.com/v1/messages', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'x-api-key': apiKey,
            'anthropic-version': '2023-06-01',
            'anthropic-dangerous-direct-browser-access': 'true'
          },
          body: JSON.stringify({
            model: 'claude-sonnet-4-20250514',
            max_tokens: 4000,
            messages: [{
              role: 'user',
              content: [
                {
                  type: 'image',
                  source: {
                    type: 'base64',
                    media_type: 'image/jpeg',
                    data: currentImageBase64
                  }
                },
                {
                  type: 'text',
                  text: prompt
                }
              ]
            }]
          })
        });

        const data = await response.json();
        
        if (data.error) {
          throw new Error(data.error.message);
        }

        const content = data.content[0].text;
        
        // Parse JSON
        let jsonMatch = content.match(/\{[\s\S]*\}/);
        if (jsonMatch) {
          analysisResult = JSON.parse(jsonMatch[0]);
          displayResults(analysisResult);
        } else {
          throw new Error('Resposta inv√°lida da API');
        }

      } catch (error) {
        console.error(error);
        showToast('Erro: ' + error.message);
      } finally {
        btn.disabled = false;
        btn.classList.remove('analyzing');
        btnText.textContent = 'üîç Analisar Refer√™ncia';
      }
    }

    function displayResults(result) {
      document.getElementById('emptyState').classList.add('hidden');
      document.getElementById('analysisResult').classList.remove('hidden');

      // Description
      document.getElementById('descriptionContent').innerHTML = `<p>${result.description}</p>`;

      // Palette
      const paletteEl = document.getElementById('paletteColors');
      paletteEl.innerHTML = result.palette.colors.map(color => 
        `<div class="color-swatch" style="background: ${color}" onclick="copyColor('${color}')" title="${color}"></div>`
      ).join('');
      document.getElementById('paletteDescription').textContent = result.palette.description;

      // Comercial
      const comercialBadge = document.getElementById('comercialBadge');
      const levels = {
        high: { class: 'comercial-high', text: 'üöÄ Alto Potencial' },
        medium: { class: 'comercial-medium', text: 'üìà M√©dio Potencial' },
        low: { class: 'comercial-low', text: 'üíú Nicho/Art√≠stico' }
      };
      const level = levels[result.comercial.level] || levels.medium;
      comercialBadge.innerHTML = `<span class="comercial-badge ${level.class}">${level.text}</span>`;
      document.getElementById('comercialDescription').textContent = result.comercial.description;

      // Prompts
      document.getElementById('promptSeamless').textContent = result.prompts.seamless;
      document.getElementById('promptLocalized').textContent = result.prompts.localized;
      document.getElementById('promptBorder').textContent = result.prompts.border;
      document.getElementById('promptSora').textContent = result.prompts.sora;
    }

    // Copy functions
    function copyPrompt(type) {
      if (!analysisResult) return;
      const prompts = {
        seamless: analysisResult.prompts.seamless,
        localized: analysisResult.prompts.localized,
        border: analysisResult.prompts.border,
        sora: analysisResult.prompts.sora
      };
      navigator.clipboard.writeText(prompts[type]);
      showToast('Prompt copiado!');
    }

    function copyColor(color) {
      navigator.clipboard.writeText(color);
      showToast(`Cor ${color} copiada!`);
    }

    function copyAllPrompts() {
      if (!analysisResult) return;
      const allPrompts = `ESTAMPA CORRIDA:\n${analysisResult.prompts.seamless}\n\nESTAMPA LOCALIZADA:\n${analysisResult.prompts.localized}\n\nBARRA/CERCADURA:\n${analysisResult.prompts.border}\n\nSORA (ELEMENTO √öNICO):\n${analysisResult.prompts.sora}`;
      navigator.clipboard.writeText(allPrompts);
      showToast('Todos os prompts copiados!');
    }

    // Save/Export
    function saveAnalysis() {
      if (!analysisResult || !currentImage) {
        showToast('Nenhuma an√°lise para salvar');
        return;
      }

      const entry = {
        id: Date.now(),
        date: new Date().toLocaleDateString('pt-BR'),
        thumbnail: currentImage,
        result: analysisResult,
        notes: document.getElementById('userNotes').value
      };

      history.unshift(entry);
      if (history.length > 20) history = history.slice(0, 20);
      localStorage.setItem('lune_studio_history', JSON.stringify(history));
      renderHistory();
      showToast('An√°lise salva!');
    }

    function renderHistory() {
      const list = document.getElementById('historyList');
      const empty = document.getElementById('historyEmpty');
      const count = document.getElementById('historyCount');

      count.textContent = `${history.length} an√°lise${history.length !== 1 ? 's' : ''}`;

      if (history.length === 0) {
        list.innerHTML = '';
        empty.classList.remove('hidden');
        return;
      }

      empty.classList.add('hidden');
      list.innerHTML = history.map((item, i) => `
        <div class="bg-[#111820] rounded-xl overflow-hidden border border-[#1c252f] hover:border-[#00d4aa] transition-all cursor-pointer" onclick="loadAnalysis(${i})">
          <img src="${item.thumbnail}" class="w-full h-32 object-cover" />
          <div class="p-3">
            <p class="text-xs text-[#8899a6]">${item.date}</p>
            <div class="flex gap-1 mt-2">
              ${item.result.palette.colors.slice(0, 5).map(c => `<div class="w-4 h-4 rounded" style="background: ${c}"></div>`).join('')}
            </div>
          </div>
        </div>
      `).join('');
    }

    function loadAnalysis(index) {
      const item = history[index];
      if (!item) return;
      
      currentImage = item.thumbnail;
      currentImageBase64 = item.thumbnail.split(',')[1];
      analysisResult = item.result;
      
      document.getElementById('previewImage').src = currentImage;
      document.getElementById('uploadPrompt').classList.add('hidden');
      document.getElementById('previewContainer').classList.remove('hidden');
      document.getElementById('analyzeBtn').disabled = false;
      document.getElementById('userNotes').value = item.notes || '';
      
      displayResults(item.result);
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function saveNotes() {
      // Auto-save notes in current session
    }

    function addToMoodboard() {
      showToast('Moodboards em breve!');
    }

    function exportPDF() {
      if (!analysisResult) {
        showToast('Nenhuma an√°lise para exportar');
        return;
      }
      showToast('Exportando PDF...');
      // TODO: Implement PDF export
    }

    // Toast
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.remove('opacity-0');
      toast.classList.add('opacity-100');
      setTimeout(() => {
        toast.classList.remove('opacity-100');
        toast.classList.add('opacity-0');
      }, 2500);
    }
  </script>
</body>
</html>
